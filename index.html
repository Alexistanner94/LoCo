<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="assets/js/weather.js"></script>
    <script type="text/javascript" src="assets/js/script.js"></script>

    <link rel="stylesheet" href="assets/css/reset.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
    <!-- <link rel="stylesheet" href="assets/css/bulma.min.css"> -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/typography.css">
    <!-- <link rel="stylesheet" href="assets/css/style.css"> -->
    <link rel="stylesheet" href="assets/css/style_new.css">


    <title>LoCo</title>
</head>

<body>
    <div id="backgroundImage"></div>
    <header class="header">
        <div class="container">
            <div class="columns">
                <div class="column">
                    <h1>LoCo</h1>
                    <h2 class="small">A search for happenings</h2>
                </div>
            </div>
        </div>
    </header>

    <section class="section">
        <div class="container">
            <form id="searchToggle">
                  <img src="assets/img/musicLogo.png"  class="searchTopic btn" id="bandButton" value="band" >
                   <img src="assets/img/city.png"  class="searchTopic btn" id="cityButton" value="city" >
            </form>

            <select class="select monthSelect" id="monthSelect">
                <option value="0">Choose Month:</option>
                <option value="01">January</option>
                <option value="02">February</option>
                <option value="03">March</option>
                <option value="04">April</option>
                <option value="05">May</option>
                <option value="06">June</option>
                <option value="07">July</option>
                <option value="08">August</option>
                <option value="09">September</option>
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
            </select>

            <div class="columns" id="searchInputs">
                <div class="column">
                    <div class="columns bandCol">
                        <div class="column" id="bandSearch">
                            <input onfocus="this.value=''" type="text" class="search" id="bandVal"
                                placeholder="Band"></input>
                        </div>
                    </div>
                    <div class="columms">
                        <div class="columns">
                            <div class="column citySearch" id="citySearch">
                                <input onfocus="this.value=''" type=" text" class="search" id="cityVal"
                                    placeholder="City"></input>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="column is-narrow has-text-centered">

                    <input id="searchbtn" class="btn" type="submit" value="Search">

                </div>
            </div>
        </div>
    </section>



    <section class="section">
        <div class="container" id="ajaxResponse">





        </div>
    </section>

    <!-- Already included in head <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> -->
    <script type="text/javascript">
        $(document).ready(function () {
            $('#bandVal').focus();

            searchType = "band";
            $("#cityButton").on("click", function () {
                searchType = "place";
                $(".citySearch").css("display", "flex");
                $(".monthSelect").css("display", "inline-block");
                $("#bandSearch").css("display", "none");
                $("#cityButton").css({
                   "height": "50px"
                });
                $("#bandButton").css({
                   "height": "40px"
                });
                $('#cityVal').focus();

            });

            $("#bandButton").on("click", function () {
                searchType = "band";
                $(".citySearch,.monthSelect").css("display", "none");
                $("#bandSearch").css("display", "flex");
                $("#bandButton").css("height", "50px"};   
                $("#cityButton").css("height", "40px");  
                $('#bandVal').focus();
            });

           

            //object for ajax
            $('#searchbtn').on("click", loCoSearch);
            document.onkeydown = function (e) {
                // console.log("evaluating");
                if (e.key == "Enter")
                    loCoSearch();
            };

            function loCoSearch(e) {
                //e.preventDefault();
                let searchParams = {};
                if (searchType == "band") {
                    //search by band
                    let searchQ = $('#bandVal').val().replace(/\s+/g, '-');
                    console.log("sQ: " + searchQ);
                    searchParams["performers.slug"] = searchQ;
                    $('#bandVal').val('')
                } else {
                    //search by city and month
                    let date = new Date();
                    let thisYear = date.getFullYear();
                    let monthCurrent = date.getMonth();
                    let lastDay = new Date(thisYear, $('#monthSelect').val(), 0);
                    lastDay = lastDay.getDate();
                    //console.log("monthC" + monthCurrent);
                    // console.log("lastDay" + lastDay);

                    searchParams["venue.city"] = $('#cityVal').val().replace(/\s+/g, '-');

                    if ($('#monthSelect') > 0) { 
                    if ($('#monthSelect').val() < monthCurrent) {
                        thisYear += 1;
                        searchParams["datetime_local.gte"] = `${thisYear}-${$('#monthSelect').val()}-01`;
                    } else {
                        searchParams["datetime_local.gte"] = `${thisYear}-${$('#monthSelect').val()}-01`;

                    };
                }
                // searchParams["datetime_local.lte"] = `${thisYear}-${$('#monthSelect').val()}-31`;
                // console.log("monthSelect " + $('#monthSelect').val());
            }

            getEvents(searchParams);
            $('#cityVal').val('');
            return searchType
        };





        });
    </script>

</body>

</html>